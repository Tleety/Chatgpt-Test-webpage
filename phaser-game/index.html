<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="../favicon.svg" type="image/svg+xml">
  <title>Snake Game</title>
  <link rel="stylesheet" href="../style.css">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    main { 
      text-align: center; 
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: calc(100vh - 60px); /* Account for header height */
      justify-content: center;
      padding: 20px;
    }
    #game { 
      margin: 20px auto;
      display: inline-block;
    }
  </style>
</head>
<body>
  <header class="top-bar">
    <img src="../favicon.svg" alt="Site logo" class="logo">
    <span class="title">My GitHub Page</span>
  </header>
  <main>
    <h1>Snake Game</h1>
    <p>Use the arrow keys to move the snake and eat the red squares. Don't run into the walls or yourself!</p>
    <div id="game"></div>
  </main>
  <script src="snake-game.js"></script>
  <script>
    const CELL_SIZE = 20;
    let cursors;
    let gameLogic;
    let snakeSegments = [];
    let foodSprite;
    
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      backgroundColor: '#000',
      parent: 'game',
      scene: {
        create,
        update
      }
    };

    function create() {
      // Initialize game logic
      gameLogic = new SnakeGame({ width: config.width, height: config.height });
      gameLogic.initGame();
      
      cursors = this.input.keyboard.createCursorKeys();
      this.scoreText = this.add.text(10, 10, 'Score: 0', { font: '20px Arial', fill: '#fff' });

      // Create visual snake segments
      snakeSegments = [];
      const state = gameLogic.getGameState();
      state.snake.forEach(segment => {
        const segmentSprite = this.add.rectangle(segment.x, segment.y, CELL_SIZE, CELL_SIZE, 0x00ff00).setOrigin(0);
        snakeSegments.push(segmentSprite);
      });

      // Create food sprite
      foodSprite = this.add.rectangle(state.food.x, state.food.y, CELL_SIZE, CELL_SIZE, 0xff0000).setOrigin(0);

      this.time.addEvent({ delay: 150, callback: move, callbackScope: this, loop: true });
    }

    function update() {
      if (cursors.left.isDown) {
        gameLogic.changeDirection({ x: -CELL_SIZE, y: 0 });
      } else if (cursors.right.isDown) {
        gameLogic.changeDirection({ x: CELL_SIZE, y: 0 });
      } else if (cursors.up.isDown) {
        gameLogic.changeDirection({ x: 0, y: -CELL_SIZE });
      } else if (cursors.down.isDown) {
        gameLogic.changeDirection({ x: 0, y: CELL_SIZE });
      }
    }

    function move() {
      const result = gameLogic.moveSnake();
      
      if (result.gameOver) {
        // Reset game logic
        gameLogic.initGame();
        
        // Clear old visual elements
        snakeSegments.forEach(segment => segment.destroy());
        snakeSegments = [];
        
        // Create new visual snake
        const state = gameLogic.getGameState();
        state.snake.forEach(segment => {
          const segmentSprite = this.add.rectangle(segment.x, segment.y, CELL_SIZE, CELL_SIZE, 0x00ff00).setOrigin(0);
          snakeSegments.push(segmentSprite);
        });
        
        // Update food position
        foodSprite.setPosition(state.food.x, state.food.y);
        
        // Update score display
        this.scoreText.setText('Score: ' + gameLogic.score);
        return;
      }

      // Update visual representation
      const state = gameLogic.getGameState();
      
      // Remove old snake segments
      snakeSegments.forEach(segment => segment.destroy());
      snakeSegments = [];
      
      // Create new snake segments
      state.snake.forEach(segment => {
        const segmentSprite = this.add.rectangle(segment.x, segment.y, CELL_SIZE, CELL_SIZE, 0x00ff00).setOrigin(0);
        snakeSegments.push(segmentSprite);
      });
      
      // Update food position if needed
      foodSprite.setPosition(state.food.x, state.food.y);
      
      // Update score
      this.scoreText.setText('Score: ' + state.score);
    }

    new Phaser.Game(config);
  </script>
</body>
</html>
