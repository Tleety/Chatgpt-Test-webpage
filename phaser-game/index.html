<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="../favicon.svg" type="image/svg+xml">
  <title>Snake Game</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    main { 
      text-align: center; 
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: calc(100vh - 60px); /* Account for header height */
      justify-content: center;
      padding: 20px;
    }
    #gameContainer { 
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #gameCanvas { 
      border: 2px solid #333;
      background: #000;
      display: block;
    }
    #score {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    #gameOver {
      color: #ff0000;
      font-size: 20px;
      font-weight: bold;
      margin-top: 10px;
    }
    
    /* High Score Section */
    #highScoreSection {
      margin-left: 40px;
      padding: 20px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      min-width: 250px;
    }
    
    #highScoreSection h3 {
      margin-top: 0;
      color: #333;
      font-size: 18px;
    }
    
    #highScoreList {
      text-align: left;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .high-score-item {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
      border-bottom: 1px solid #eee;
    }
    
    .high-score-item:last-child {
      border-bottom: none;
    }
    
    .high-score-rank {
      color: #666;
      width: 25px;
    }
    
    .high-score-name {
      flex: 1;
      padding: 0 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .high-score-score {
      color: #333;
      font-weight: bold;
    }
    
    /* Game Layout */
    #gameLayout {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      justify-content: center;
    }
    
    /* High Score Modal */
    #highScoreModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    #highScoreModal.hidden {
      display: none;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    
    .modal-content h2 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .modal-content p {
      color: #666;
      margin-bottom: 20px;
    }
    
    #playerNameInput {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    
    #playerNameInput:focus {
      outline: none;
      border-color: #4CAF50;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    .modal-button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .modal-button.primary {
      background: #4CAF50;
      color: white;
    }
    
    .modal-button.primary:hover {
      background: #45a049;
    }
    
    .modal-button.secondary {
      background: #f44336;
      color: white;
    }
    
    .modal-button.secondary:hover {
      background: #da190b;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      #gameLayout {
        flex-direction: column;
        align-items: center;
      }
      
      #highScoreSection {
        margin-left: 0;
        margin-top: 20px;
        width: 100%;
        max-width: 400px;
      }
    }
  </style>
</head>
<body>
  <script src="../top-bar.js"></script>
  <main>
    <h1>Snake Game</h1>
    <p>Use the arrow keys to move the snake and eat the red squares. Don't run into the walls or yourself!</p>
    <div id="gameLayout">
      <div id="gameContainer">
        <div id="score">Score: 0</div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="gameOver" style="display: none;">Game Over! Press SPACE to restart</div>
      </div>
      <div id="highScoreSection">
        <h3>üèÜ High Scores</h3>
        <div id="highScoreList">
          <div style="color: #999; text-align: center; padding: 20px;">No scores yet!</div>
        </div>
      </div>
    </div>
    
    <!-- High Score Modal -->
    <div id="highScoreModal" class="hidden">
      <div class="modal-content">
        <h2>üéâ New High Score!</h2>
        <p>Congratulations! You scored <span id="newScoreValue">0</span> points!</p>
        <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="20">
        <div class="modal-buttons">
          <button class="modal-button primary" id="saveScoreBtn">Save Score</button>
          <button class="modal-button secondary" id="skipScoreBtn">Skip</button>
        </div>
      </div>
    </div>
  </main>
  <script src="../snake-game-logic.js"></script>
  <script>
    // Canvas-based Snake Game Implementation
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    const gameOverElement = document.getElementById('gameOver');
    const highScoreListElement = document.getElementById('highScoreList');
    const highScoreModal = document.getElementById('highScoreModal');
    const newScoreValueElement = document.getElementById('newScoreValue');
    const playerNameInput = document.getElementById('playerNameInput');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const skipScoreBtn = document.getElementById('skipScoreBtn');
    
    // Game state
    let game = new SnakeGameLogic(800, 600);
    let gameRunning = true;
    let lastFrameTime = 0;
    const frameDelay = 150; // milliseconds between moves
    
    // High Score Management
    function updateHighScoreDisplay() {
      const highScores = game.getHighScores();
      
      if (highScores.length === 0) {
        highScoreListElement.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">No scores yet!</div>';
        return;
      }
      
      const html = highScores.map((score, index) => `
        <div class="high-score-item">
          <span class="high-score-rank">${index + 1}.</span>
          <span class="high-score-name">${score.name}</span>
          <span class="high-score-score">${score.score}</span>
        </div>
      `).join('');
      
      highScoreListElement.innerHTML = html;
    }
    
    function showHighScoreModal(score) {
      newScoreValueElement.textContent = score;
      playerNameInput.value = '';
      highScoreModal.classList.remove('hidden');
      playerNameInput.focus();
    }
    
    function hideHighScoreModal() {
      highScoreModal.classList.add('hidden');
    }
    
    function saveHighScore() {
      const name = playerNameInput.value.trim();
      const score = parseInt(newScoreValueElement.textContent);
      
      game.addHighScore(name, score);
      updateHighScoreDisplay();
      hideHighScoreModal();
    }
    
    // Event listeners for high score modal
    saveScoreBtn.addEventListener('click', saveHighScore);
    skipScoreBtn.addEventListener('click', hideHighScoreModal);
    
    playerNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        saveHighScore();
      } else if (e.key === 'Escape') {
        hideHighScoreModal();
      }
    });
    
    // Input handling
    const keys = {};
    document.addEventListener('keydown', (e) => {
      keys[e.code] = true;
      
      if (e.code === 'Space' && !gameRunning) {
        restartGame();
        e.preventDefault();
      }
      
      // Prevent default behavior for arrow keys to stop page scrolling
      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
        e.preventDefault();
      }
    });
    
    document.addEventListener('keyup', (e) => {
      keys[e.code] = false;
    });
    
    // Game functions
    function handleInput() {
      if (keys['ArrowLeft'] && game.direction.x === 0) {
        game.changeDirection({ x: -20, y: 0 });
      } else if (keys['ArrowRight'] && game.direction.x === 0) {
        game.changeDirection({ x: 20, y: 0 });
      } else if (keys['ArrowUp'] && game.direction.y === 0) {
        game.changeDirection({ x: 0, y: -20 });
      } else if (keys['ArrowDown'] && game.direction.y === 0) {
        game.changeDirection({ x: 0, y: 20 });
      }
    }
    
    function render() {
      // Clear canvas
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      const state = game.getGameState();
      
      // Draw snake
      ctx.fillStyle = '#00ff00';
      state.snake.forEach(segment => {
        ctx.fillRect(segment.x, segment.y, game.CELL_SIZE, game.CELL_SIZE);
      });
      
      // Draw food
      ctx.fillStyle = '#ff0000';
      ctx.fillRect(state.food.x, state.food.y, game.CELL_SIZE, game.CELL_SIZE);
      
      // Update score
      scoreElement.textContent = `Score: ${state.score}`;
    }
    
    function gameLoop(currentTime) {
      if (!gameRunning) return;
      
      handleInput();
      
      // Move snake at fixed intervals
      if (currentTime - lastFrameTime >= frameDelay) {
        const result = game.moveSnake();
        
        if (result.collision) {
          gameRunning = false;
          gameOverElement.style.display = 'block';
          
          // Check for high score
          const finalScore = result.newScore;
          if (game.isHighScore(finalScore)) {
            showHighScoreModal(finalScore);
          }
          
          return;
        }
        
        lastFrameTime = currentTime;
      }
      
      render();
      requestAnimationFrame(gameLoop);
    }
    
    function restartGame() {
      game.reset();
      gameRunning = true;
      gameOverElement.style.display = 'none';
      lastFrameTime = 0;
      requestAnimationFrame(gameLoop);
    }
    
    // Initialize the game
    updateHighScoreDisplay();
    render();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
