<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <title>Bevy Game Foundation</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        #bevy-game-canvas {
            display: block;
            margin: 0;
            border: none;
            background: #1a1a1a;
            width: 100vw;
            height: calc(100vh - 60px); /* Full height minus top bar */
        }
        
        .game-container {
            text-align: center;
            padding: 0;
            margin: 0;
            width: 100%;
            height: calc(100vh - 60px);
        }
        
        .loading {
            font-size: 18px;
            color: #333;
            margin: 20px 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .fallback {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            padding: 15px;
            border-radius: 5px;
            margin: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 600px;
        }
        
        .fallback h3 {
            margin: 0 0 10px 0;
            color: #cc0000;
        }
    </style>
</head>
<body>
    <script src="../top-bar.js"></script>
    <main>
        <div class="game-container">
            <h1>Bevy Game Foundation</h1>
            
            <div class="game-info">
                <h2>About This Demo</h2>
                <p>This is a <strong>Bevy game engine foundation</strong> built with Rust and WebAssembly.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Entity-Component-System (ECS) architecture</li>
                    <li>Target-based movement system with configurable behavior</li>
                    <li>Sprites can seek targets, find new ones, or stay still</li>
                    <li>Built with Rust and compiled to WebAssembly</li>
                    <li>Game loop with proper timing and rendering</li>
                    <li>Foundation for expanding to full Bevy integration</li>
                </ul>
                <div class="controls">
                    Watch the colored squares demonstrate target-seeking behavior! Red square finds new targets, cyan square stops after reaching its target, blue square has no target and stays still.
                </div>
            </div>
            
            <div id="loading" class="loading">Loading Bevy game foundation...</div>
            <canvas id="bevy-game-canvas" style="display: none;"></canvas>
            
            <div id="fallback" class="fallback" style="display: none;">
                <h3>Build Required</h3>
                <p>The WebAssembly files need to be built. To build and run this demo:</p>
                <pre>cd bevy-game
./build.sh</pre>
                <p>This will compile the Rust code to WebAssembly and generate the necessary pkg/ files.</p>
            </div>
        </div>
    </main>

    <script type="module">
        let game = null;
        
        function animationLoop() {
            if (game) {
                game.render_frame();
                requestAnimationFrame(animationLoop);
            }
        }
        
        async function run() {
            try {
                const module = await import('./pkg/bevy_game.js');
                await module.default();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('bevy-game-canvas').style.display = 'block';
                
                game = new module.BevyGame('bevy-game-canvas');
                
                // Start the animation loop from JavaScript
                animationLoop();
                
                // Store game instance for potential cleanup
                window.bevyGame = game;
                
            } catch (error) {
                console.error('Failed to load Bevy game:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('fallback').style.display = 'block';
            }
        }
        
        run();
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.bevyGame) {
                // Game cleanup is now handled by JavaScript animation loop
                game = null;
            }
        });
    </script>
</body>
</html>