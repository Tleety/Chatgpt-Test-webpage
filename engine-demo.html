<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity-Based Game Engine Demo</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <style>
        main {
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: calc(100vh - 60px);
        }
        
        #gameContainer {
            margin: 20px 0;
            border: 2px solid #333;
            background: #000;
        }
        
        #controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .control-button:hover {
            background: #45a049;
        }
        
        .control-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        #stats {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: #f9f9f9;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        #info {
            max-width: 800px;
            text-align: left;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        #info h3 {
            margin-top: 0;
            color: #333;
        }
        
        #info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        #info li {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        code {
            background: #e8e8e8;
            padding: 2px 4px;
            border-radius: 2px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <script src="top-bar.js"></script>
    
    <main>
        <h1>Entity-Based Game Engine Demo</h1>
        <p>A demonstration of the new Entity-Component-System (ECS) architecture</p>
        
        <div id="stats">
            <div class="stat-item">FPS: <span id="fps">0</span></div>
            <div class="stat-item">Entities: <span id="entityCount">0</span></div>
            <div class="stat-item">Systems: <span id="systemCount">0</span></div>
            <div class="stat-item">Engine: <span id="engineState">Stopped</span></div>
        </div>
        
        <canvas id="gameContainer" width="800" height="600"></canvas>
        
        <div id="controls">
            <button class="control-button" id="startBtn">Start Engine</button>
            <button class="control-button" id="pauseBtn" disabled>Pause</button>
            <button class="control-button" id="resumeBtn" disabled>Resume</button>
            <button class="control-button" id="stopBtn" disabled>Stop</button>
            <button class="control-button" id="addEntityBtn">Add Entity</button>
            <button class="control-button" id="clearBtn">Clear All</button>
        </div>
        
        <div id="info">
            <h3>ðŸŽ® Entity-Component-System (ECS) Architecture Demo</h3>
            <p>This demo showcases a full entity-based game engine built with ECS principles:</p>
            
            <h4>Core Features:</h4>
            <ul>
                <li><strong>Entity Management:</strong> Create/destroy game entities with unique IDs</li>
                <li><strong>Component System:</strong> Position, Velocity, and Renderable components</li>
                <li><strong>System Processing:</strong> Movement and Render systems operating on entities</li>
                <li><strong>Real-time Updates:</strong> 60 FPS game loop with delta time calculations</li>
                <li><strong>Camera System:</strong> World-to-screen coordinate transformation</li>
                <li><strong>Event System:</strong> Inter-system communication via events</li>
            </ul>
            
            <h4>How to Use:</h4>
            <ul>
                <li><strong>Start Engine:</strong> Begin the game loop and system processing</li>
                <li><strong>Add Entity:</strong> Create new game objects with random properties</li>
                <li><strong>Mouse Click:</strong> Click on the canvas to create entities at that position</li>
                <li><strong>WASD Keys:</strong> Move the camera around the world</li>
                <li><strong>Mouse Wheel:</strong> Zoom in/out of the world</li>
            </ul>
            
            <h4>Technical Architecture:</h4>
            <ul>
                <li><strong>EntityManager:</strong> Central registry for all entities and components</li>
                <li><strong>SystemManager:</strong> Executes systems in priority order each frame</li>
                <li><strong>MovementSystem:</strong> Updates entity positions based on velocity</li>
                <li><strong>RenderSystem:</strong> Draws entities with transform and camera support</li>
                <li><strong>Components:</strong> Data-only containers (Position, Velocity, Renderable)</li>
            </ul>
            
            <p><em>This engine architecture is scalable and can be extended with additional components and systems like Physics, Audio, AI, Collision Detection, and more.</em></p>
        </div>
    </main>
    
    <!-- Load the engine as a single bundle -->
    <script src="engine/js/engine-bundle.js"></script>
    <script src="engine/core/system.js"></script>
    <script src="engine/core/system-manager.js"></script>
    <script src="engine/components/position.js"></script>
    <script src="engine/components/velocity.js"></script>
    <script src="engine/components/renderable.js"></script>
    <script src="engine/systems/movement-system.js"></script>
    <script src="engine/systems/render-system.js"></script>
    <script src="engine/game-engine.js"></script>
    
    <script>
        // Initialize the game engine
        const canvas = document.getElementById('gameContainer');
        const engine = new GameEngine(canvas);
        
        // UI elements
        const fpsElement = document.getElementById('fps');
        const entityCountElement = document.getElementById('entityCount');
        const systemCountElement = document.getElementById('systemCount');
        const engineStateElement = document.getElementById('engineState');
        
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const addEntityBtn = document.getElementById('addEntityBtn');
        const clearBtn = document.getElementById('clearBtn');
        
        // Engine event handlers
        engine.on('fpsUpdate', (data) => {
            fpsElement.textContent = data.fps;
        });
        
        engine.on('update', () => {
            const stats = engine.getStats();
            entityCountElement.textContent = stats.entityCount;
            systemCountElement.textContent = stats.systemCount;
        });
        
        engine.on('engineStarted', () => {
            engineStateElement.textContent = 'Running';
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
        });
        
        engine.on('enginePaused', () => {
            engineStateElement.textContent = 'Paused';
            pauseBtn.disabled = true;
            resumeBtn.disabled = false;
        });
        
        engine.on('engineResumed', () => {
            engineStateElement.textContent = 'Running';
            pauseBtn.disabled = false;
            resumeBtn.disabled = true;
        });
        
        engine.on('engineStopped', () => {
            engineStateElement.textContent = 'Stopped';
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            resumeBtn.disabled = true;
            stopBtn.disabled = true;
        });
        
        // Button event handlers
        startBtn.addEventListener('click', () => engine.start());
        pauseBtn.addEventListener('click', () => engine.pause());
        resumeBtn.addEventListener('click', () => engine.resume());
        stopBtn.addEventListener('click', () => engine.stop());
        clearBtn.addEventListener('click', () => engine.clear());
        
        // Add random entity function
        function addRandomEntity() {
            const x = Math.random() * 800;
            const y = Math.random() * 600;
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            const shapes = ['rectangle', 'circle'];
            
            const entityId = engine.createGameObject(x, y, {
                width: 15 + Math.random() * 25,
                height: 15 + Math.random() * 25,
                color: colors[Math.floor(Math.random() * colors.length)],
                shape: shapes[Math.floor(Math.random() * shapes.length)],
                maxSpeed: 50 + Math.random() * 100,
                friction: 0.02 + Math.random() * 0.05
            });
            
            // Give it some initial velocity
            const vx = (Math.random() - 0.5) * 100;
            const vy = (Math.random() - 0.5) * 100;
            engine.setEntityVelocity(entityId, vx, vy);
            
            return entityId;
        }
        
        addEntityBtn.addEventListener('click', addRandomEntity);
        
        // Mouse click to add entities
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Convert screen coordinates to world coordinates
            const camera = engine.getCamera();
            const worldX = x / camera.zoom + camera.x;
            const worldY = y / camera.zoom + camera.y;
            
            const entityId = engine.createGameObject(worldX, worldY, {
                width: 20,
                height: 20,
                color: '#ffffff',
                maxSpeed: 80
            });
            
            // Add some random velocity
            const vx = (Math.random() - 0.5) * 60;
            const vy = (Math.random() - 0.5) * 60;
            engine.setEntityVelocity(entityId, vx, vy);
        });
        
        // Camera controls with WASD
        const keys = {};
        const cameraSpeed = 200; // pixels per second
        
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // Update camera based on input
        engine.on('update', (data) => {
            const deltaSeconds = data.deltaTime / 1000;
            const camera = engine.getCamera();
            let dx = 0, dy = 0;
            
            if (keys['KeyW'] || keys['ArrowUp']) dy -= cameraSpeed * deltaSeconds;
            if (keys['KeyS'] || keys['ArrowDown']) dy += cameraSpeed * deltaSeconds;
            if (keys['KeyA'] || keys['ArrowLeft']) dx -= cameraSpeed * deltaSeconds;
            if (keys['KeyD'] || keys['ArrowRight']) dx += cameraSpeed * deltaSeconds;
            
            if (dx !== 0 || dy !== 0) {
                engine.setCamera(camera.x + dx, camera.y + dy, camera.zoom);
            }
        });
        
        // Mouse wheel zoom
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const camera = engine.getCamera();
            const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
            const newZoom = Math.max(0.1, Math.min(3, camera.zoom * zoomFactor));
            engine.setCamera(camera.x, camera.y, newZoom);
        });
        
        // Initialize with a few entities
        for (let i = 0; i < 5; i++) {
            addRandomEntity();
        }
        
        // Update initial stats
        const stats = engine.getStats();
        entityCountElement.textContent = stats.entityCount;
        systemCountElement.textContent = stats.systemCount;
        
        // Start the engine automatically
        engine.start();
    </script>
</body>
</html>